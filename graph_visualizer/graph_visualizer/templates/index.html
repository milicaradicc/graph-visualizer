{% extends 'base.html' %}
{% block head_content %}
    {% load static %}
    <link rel="stylesheet" href="{% static 'tree_view.css' %}">
{% endblock %}

{% block content %}
<!-- Workspace management -->
{% include "workspace_management.html" %}

<!-- Popups -->
{% if messages %}
<div class="popup-container">
  {% for message in messages %}
    <div class="popup {{ message.tags }}">
      <span class="popup-text">{{ message }}</span>
      <span class="popup-close" onclick="this.parentElement.remove()">Ã—</span>
    </div>
  {% endfor %}
</div>
{% endif %}

<script>
    // Auto-close popups after 5 seconds
    setTimeout(() => {
      document.querySelectorAll(".popup").forEach(popup => popup.remove());
    }, 5000);
</script>

<div class="graph-container">
    <!-- Controls for visualizer switch -->
    <div class="controls">
        <label for="visualizer-select">Choose visualizer:</label>
        <select id="visualizer-select">
            {% for plugin in visualizer_plugins %}
                <option value="{{ plugin.identifier }}" {% if forloop.first %}selected{% endif %}>
                    {{ plugin.name }}
                </option>
            {% endfor %}
        </select>
    </div>

    <!-- Views container -->
    <div class="views-container">
        <div class="left-view">
        <!-- Tree View -->
            <div class="view tree-view">
                <div class="view-header">Tree View</div>
                <div class="view-content" id="tree-container"></div>
            </div>
        <!-- Bird View -->
            <div id="bird-view" class="graph-view">
                <h3>Bird View</h3>
                <div class="view-content">
                    <svg id="bird-svg"></svg>
                </div>
            </div>
        </div>
        <div class="right-view">
        <!-- Main View -->
            <div id="main-view" class="graph-view">
                <h3>Main View</h3>
                <div class="visualizer-content" id="visualizer-content">
                    {% if initial_visualizer_html and default_plugin %}
                        <div id="visualizer-{{ default_plugin.identifier }}"
                             data-plugin-id="{{ default_plugin.identifier }}"
                             class="active">
                            {{ initial_visualizer_html|safe }}
                        </div>
                    {% else %}
                        <div>
                            <p>No graph data available. Please load data first.</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    window.graphData = {{ graph_json|safe }};
</script>

{% load static %}
<script src="{% static 'tree_view.js' %}"></script>
<script src="{% static 'main_view.js' %}"></script>
<script src="{% static 'graph-interactions.js' %}"></script>
<script src="{% static 'visualizer-switching.js' %}"></script>
{% endblock %}