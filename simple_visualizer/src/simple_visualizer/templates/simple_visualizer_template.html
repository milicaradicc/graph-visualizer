<style>
#simple_visualizer {
    width: 100%;
    height: 100%;
    display: block !important;
    .node {
        cursor: pointer;
        fill: white;
        stroke: black;
        stroke-width: 2px;
    }

    .node:hover {
        fill: #f5f5f5;
        stroke-width: 3px;
    }

    .link {
        fill: none !important;
        stroke: black;
        stroke-width: 1.5px;
    }

    .link.directed {
        marker-end: url(#arrowhead);
    }

    .node-label {
        font-family: Arial, sans-serif;
        font-size: 10px;
        font-weight: bold;
        fill: red;
        text-anchor: middle;
        pointer-events: none;
        dominant-baseline: central;
    }

    .arrowhead {
        fill: red;
    }
}
</style>

<div style="width: 100%; height: 100%; position: relative;">
    <svg id="simple_visualizer"></svg>
</div>

<script>

function createSimpleVisualization() {
    const nodes = {{ nodes | tojson }};
    const links = {{ edges | tojson }};
    const isDirected = {{ directed | tojson }};
    const containerElement = document.querySelector("#simple_visualizer").parentNode;
    const width = Math.max(containerElement.clientWidth || 800, 400);
    const height = Math.max(containerElement.clientHeight || 600, 300);
    const arrowSize = 9;
    const manyNodes = nodes.length >= 50;

    const minRadius = manyNodes ? 5 : 15;
    const maxRadius = manyNodes ? 25 : 60;

    if (!nodes || nodes.length === 0) {
        d3.select("#simple_visualizer")
            .append("text")
            .attr("x", 50)
            .attr("y", 50)
            .attr("fill", "red")
            .text("No graph data to display");
        return;
    }

    const degreeMap = {};
    links.forEach(l => {
        degreeMap[l.source] = (degreeMap[l.source] || 0) + 1;
        degreeMap[l.target] = (degreeMap[l.target] || 0) + 1;
    });

    const degrees = Object.values(degreeMap);
    const minDeg = Math.min(...degrees, 0);
    const maxDeg = Math.max(...degrees, 1);

    const scaleRadius = d3.scaleLinear()
        .domain([minDeg, maxDeg])
        .range([minRadius, maxRadius]);

    const nodeData = nodes.map(node => {
        const displayText = node.id || 'Unknown';
        const degree = degreeMap[node.id] || 0;
        const radius = scaleRadius(degree);

        return { ...node, radius, displayText, degree, x: width / 2, y: height / 2 };
    });

    const linkData = links.map(link => ({
        ...link,
        source: nodeData.find(n => n.id === link.source),
        target: nodeData.find(n => n.id === link.target)
    })).filter(link => link.source && link.target);

    const svg = d3.select("#simple_visualizer")
        .attr("viewBox", `0 0 ${width} ${height}`)
        .attr("preserveAspectRatio", "xMidYMid meet")
        .style("width", "100%")
        .style("height", "100%");

    svg.selectAll("*").remove();

    if (isDirected) {
        const defs = svg.append("defs");
        defs.append("marker")
            .attr("id", "arrowhead")
            .attr("viewBox", "0 -5 10 10")
            .attr("refX", 44)
            .attr("refY", 0)
            .attr("markerWidth", arrowSize)
            .attr("markerHeight", arrowSize)
            .attr("orient", "auto")
            .attr("markerUnits", "userSpaceOnUse")
            .append("path")
            .attr("d", "M0,-5L10,0L0,5")
            .attr("fill", "red");
    }

    const container = svg.append("g").attr("class", "visualization-container");

    const linkSelection = container.selectAll(".link")
        .data(linkData)
        .enter()
        .append("path")
        .attr("class", "links")
        .attr("enabled", "true")
        .attr("fill", "none")
        .attr("stroke", "black")
        .attr("stroke-width", 1.5)
        .attr("marker-end", isDirected ? "url(#arrowhead)" : null);

    const nodeGroups = container.selectAll(".node-group")
        .data(nodeData)
        .enter()
        .append("g")
        .attr("class", "node-group")
        .attr("enabled", "true")
        .attr("transform", d => `translate(${d.x},${d.y})`);

    const nodeSelection = nodeGroups
        .append("circle")
        .attr("class", "node")
        .attr("enabled", "true")
        .attr("r", d => d.radius)
        .attr("id", d => d.id);

    const textSelection = nodeGroups
        .append("text")
        .attr("class", "node-label")
        .text(d => d.displayText)
        .attr("x", 0)
        .attr("y", 0);
}
createSimpleVisualization();
</script>